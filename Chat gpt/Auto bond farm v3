-- Auto Farm Bonds V3 + Auto Replay + ESP Bonds + GUI Drag by ChatGPT

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local humanoidRootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
local farming = false
local isTweening = false

-- GUI setup
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "BondFarmGUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 200, 0, 130)
frame.Position = UDim2.new(0, 100, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.Active = true
frame.Draggable = true -- Cho phép kéo

local button = Instance.new("TextButton", frame)
button.Size = UDim2.new(1, 0, 0, 50)
button.Position = UDim2.new(0, 0, 0, 0)
button.Text = "Start Auto Farm"
button.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
button.TextColor3 = Color3.new(1, 1, 1)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 20

local espToggle = Instance.new("TextButton", frame)
espToggle.Size = UDim2.new(1, 0, 0, 30)
espToggle.Position = UDim2.new(0, 0, 0, 50)
espToggle.Text = "Toggle ESP"
espToggle.BackgroundColor3 = Color3.fromRGB(60, 60, 200)
espToggle.TextColor3 = Color3.new(1, 1, 1)
espToggle.Font = Enum.Font.SourceSansBold
espToggle.TextSize = 18

local replayToggle = Instance.new("TextButton", frame)
replayToggle.Size = UDim2.new(1, 0, 0, 30)
replayToggle.Position = UDim2.new(0, 0, 0, 80)
replayToggle.Text = "Toggle Auto Replay"
replayToggle.BackgroundColor3 = Color3.fromRGB(60, 200, 60)
replayToggle.TextColor3 = Color3.new(1, 1, 1)
replayToggle.Font = Enum.Font.SourceSansBold
replayToggle.TextSize = 18

local espEnabled = false
local autoReplayEnabled = true

-- Helper: Cập nhật HumanoidRootPart nếu cần
local function updateHRP()
    if not humanoidRootPart and player.Character then
        humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    end
end

-- Auto Farm Bonds V3
function farmBondsV3()
    updateHRP()
    if not humanoidRootPart then return end

    local bonds = {}  -- Danh sách Bonds
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Part") and v.Name == "Bond" then
            table.insert(bonds, v)
        end
    end

    local closestBond = nil
    local minDistance = math.huge

    for _, bond in ipairs(bonds) do
        local distance = (humanoidRootPart.Position - bond.Position).magnitude
        if distance < minDistance then
            minDistance = distance
            closestBond = bond
        end
    end

    if closestBond then
        if minDistance < 50 then
            -- Nếu Bond gần, di chuyển tức thì và thu thập
            humanoidRootPart.CFrame = CFrame.new(closestBond.Position + Vector3.new(0, 3, 0))
            wait(0.3)
            firetouchinterest(humanoidRootPart, closestBond, 0)
            firetouchinterest(humanoidRootPart, closestBond, 1)
        elseif not isTweening then
            -- Nếu Bond quá xa, sử dụng Tween để di chuyển mượt
            isTweening = true
            local targetPosition = closestBond.Position + Vector3.new(0, 3, 0)
            local tweenInfo = TweenInfo.new(
                1, -- thời gian tween 1 giây (có thể tùy chỉnh)
                Enum.EasingStyle.Linear
            )
            local tween = TweenService:Create(humanoidRootPart, tweenInfo, {CFrame = CFrame.new(targetPosition)})
            tween:Play()
            tween.Completed:Connect(function()
                isTweening = false
                wait(0.2)
                pcall(function()
                    firetouchinterest(humanoidRootPart, closestBond, 0)
                    firetouchinterest(humanoidRootPart, closestBond, 1)
                end)
            end)
        end
    end
end

-- Auto Replay
function autoReplay()
    if not autoReplayEnabled then return end
    local guiElements = player:WaitForChild("PlayerGui"):GetDescendants()
    for _, v in pairs(guiElements) do
        if v:IsA("TextButton") and (v.Text:lower():find("replay") or v.Text:lower():find("retry") or v.Name:lower():find("replay")) then
            pcall(function()
                v:Activate()
            end)
        end
    end
end

-- ESP Bonds: Hiển thị hộp và tên vật phẩm
function drawESP()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Part") and v.Name == "Bond" and espEnabled then
            local box = Instance.new("Frame")
            box.Size = UDim2.new(0, 10, 0, 10) -- 1cm (10px)
            -- Chuyển đổi vị trí 3D sang vị trí 2D (ScreenPoint) bằng WorldToViewportPoint
            local viewportPoint, onScreen = workspace.CurrentCamera:WorldToViewportPoint(v.Position)
            if onScreen then
                box.Position = UDim2.new(0, viewportPoint.X, 0, viewportPoint.Y)
                box.BackgroundTransparency = 0.5
                box.BorderColor3 = Color3.fromRGB(255, 0, 0)
                box.BorderSizePixel = 2
                box.Parent = gui

                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(0, 100, 0, 20)
                label.Position = UDim2.new(0, viewportPoint.X, 0, viewportPoint.Y - 10)
                label.Text = "Bond"
                label.TextColor3 = Color3.fromRGB(255, 255, 255)
                label.BackgroundTransparency = 1
                label.TextSize = 14
                label.Parent = gui

                game:GetService("Debris"):AddItem(box, 0.1)
                game:GetService("Debris"):AddItem(label, 0.1)
            end
        end
    end
end

-- Toggle các chức năng từ GUI
button.MouseButton1Click:Connect(function()
    farming = not farming
    button.Text = farming and "Stop Auto Farm" or "Start Auto Farm"
    button.BackgroundColor3 = farming and Color3.fromRGB(200, 60, 60) or Color3.fromRGB(60, 120, 60)
end)

espToggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espToggle.Text = espEnabled and "ESP ON" or "ESP OFF"
    espToggle.BackgroundColor3 = espEnabled and Color3.fromRGB(200, 60, 60) or Color3.fromRGB(60, 60, 200)
end)

replayToggle.MouseButton1Click:Connect(function()
    autoReplayEnabled = not autoReplayEnabled
    replayToggle.Text = autoReplayEnabled and "Auto Replay ON" or "Auto Replay OFF"
    replayToggle.BackgroundColor3 = autoReplayEnabled and Color3.fromRGB(60, 200, 60) or Color3.fromRGB(200, 60, 60)
end)

-- Main loop: Chạy farm và ESP liên tục
RunService.Stepped:Connect(function()
    if farming then
        pcall(farmBondsV3)
        wait(1)
        pcall(autoReplay)
    end
    pcall(drawESP)
end)
